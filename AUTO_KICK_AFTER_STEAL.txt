-- Anti "You stole" GUI detector
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

local keyword = "you stole" -- chữ cần dò, không phân biệt hoa thường
local kickMessage = "You stole brainrot!" -- tiêu đề kick chính xác

-- Hàm kiểm tra text có chứa keyword
local function hasKeyword(text)
    if typeof(text) ~= "string" then return false end
    return string.find(string.lower(text), keyword) ~= nil
end

-- Hàm kick player an toàn với tiêu đề bạn muốn
local function kickPlayer()
    local success, err = pcall(function()
        player:Kick(kickMessage)
    end)
    if not success then
        warn("Kick thất bại: "..tostring(err))
    end
end

-- Hàm quét các object GUI
local function scanGuiObjects(parent)
    for _, obj in ipairs(parent:GetDescendants()) do
        if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
            if hasKeyword(obj.Text) then
                print("⚠️ Phát hiện GUI chứa 'You stole' → Kick local player")
                kickPlayer()
                return true
            end

            -- Theo dõi khi text thay đổi
            obj:GetPropertyChangedSignal("Text"):Connect(function()
                if hasKeyword(obj.Text) then
                    print("⚠️ GUI text thay đổi thành 'You stole' → Kick local player")
                    kickPlayer()
                end
            end)
        end
    end
    return false
end

-- Hàm theo dõi GUI mới thêm
local function setupGuiWatcher(gui)
    gui.DescendantAdded:Connect(function(desc)
        if desc:IsA("TextLabel") or desc:IsA("TextButton") or desc:IsA("TextBox") then
            if hasKeyword(desc.Text) then
                print("⚠️ Phát hiện GUI chứa 'You stole' → Kick local player")
                kickPlayer()
            end

            desc:GetPropertyChangedSignal("Text"):Connect(function()
                if hasKeyword(desc.Text) then
                    print("⚠️ GUI text thay đổi thành 'You stole' → Kick local player")
                    kickPlayer()
                end
            end)
        end
    end)
end

-- Setup watcher cho tất cả GUI hiện tại
for _, gui in ipairs(PlayerGui:GetChildren()) do
    setupGuiWatcher(gui)
end

-- Khi GUI mới được thêm vào PlayerGui
PlayerGui.ChildAdded:Connect(function(gui)
    setupGuiWatcher(gui)
    scanGuiObjects(gui) -- kiểm tra ngay khi thêm
end)

-- Quét ban đầu toàn bộ PlayerGui
scanGuiObjects(PlayerGui)

print("✅ Anti 'You stole' GUI detector đã bật")







local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- Folder lưu ESP
local ESP_FOLDER = Instance.new("Folder")
ESP_FOLDER.Name = "ESP"
ESP_FOLDER.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Folder lưu Beam
local LINE_FOLDER = Instance.new("Folder")
LINE_FOLDER.Name = "ESP_Lines"
LINE_FOLDER.Parent = Workspace

local currentESP
local currentBeam
local currentPetInfo
local a0, a1

-- Hàm parse $/s chính xác hơn
local function parseMoneyPerSec(text)
    text = text:match("^%s*(.-)%s*$") -- loại bỏ khoảng trắng
    local number, suffix = text:match("%$([%d%.]+)%s*([kKmMbB]?)%s*/?s?")
    number = tonumber(number) or 0
    if suffix then
        suffix = suffix:lower()
        if suffix == "k" then number = number * 1000
        elseif suffix == "m" then number = number * 1_000_000
        elseif suffix == "b" then number = number * 1_000_000_000 end
    end
    return number
end

-- Tạo ESP cho pet
local function createESP(petName, infoText, mutationText, targetPart)
    if currentESP then currentESP:Destroy() end

    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(0, 150, 0, 50)  --      giảm từ 200x70 xuống cho vừa chữ nhỏ
    billboard.AlwaysOnTop = true
    billboard.Adornee = targetPart
    billboard.Parent = ESP_FOLDER
    billboard.StudsOffset = Vector3.new(0, 3, 0)

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.TextStrokeTransparency = 0
    textLabel.TextScaled = false
    textLabel.TextSize = 10
    textLabel.RichText = true

    textLabel.Text = string.format(
        '<font color="rgb(255,0,0)">%s</font>\n<font color="rgb(0,255,0)">%s</font>\n<font color="rgb(255,255,0)">%s</font>',
        petName, infoText, mutationText or ""
    )

    textLabel.Parent = billboard
    currentESP = billboard
end

-- Tạo beam nối với player
local function createBeam(targetPart)
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") or not targetPart then return end

    if currentBeam then
        currentBeam:Destroy()
        if a0 then a0:Destroy() end
        if a1 then a1:Destroy() end
    end

    a0 = Instance.new("Attachment")
    a0.Parent = char.HumanoidRootPart

    a1 = Instance.new("Attachment")
    a1.Parent = targetPart

    local beam = Instance.new("Beam")
    beam.Attachment0 = a0
    beam.Attachment1 = a1
    beam.Width0 = 0.35
    beam.Width1 = 0.35
    beam.FaceCamera = true
    beam.LightInfluence = 0
    beam.Parent = LINE_FOLDER

    currentBeam = beam

    task.spawn(function()
        while beam.Parent do
            local color = Color3.fromHSV((tick() % 5) / 5, 1, 1)
            beam.Color = ColorSequence.new(color)
            task.wait(0.05)
        end
    end)
end

-- Tìm con mạnh nhất
local function findBestPet()
    local PlotsFolder = Workspace:FindFirstChild("Plots")
    if not PlotsFolder then return end

    local bestValue = -1
    local bestPet = nil

    for _, plot in ipairs(PlotsFolder:GetChildren()) do
        local podiums = plot:FindFirstChild("AnimalPodiums")
        if podiums then
            for _, podium in ipairs(podiums:GetChildren()) do
                local spawnPart = podium:FindFirstChild("Base") and podium.Base:FindFirstChild("Spawn")
                if spawnPart then
                    local attachment = spawnPart:FindFirstChild("Attachment")
                    local overhead = attachment and attachment:FindFirstChild("AnimalOverhead")
                    if overhead then
                        local nameLabel = overhead:FindFirstChild("DisplayName")
                        local genLabel = overhead:FindFirstChild("Generation")
                        local mutationLabel = overhead:FindFirstChild("Mutation")
                        if genLabel then
                            local petName = nameLabel and nameLabel.Text or "Unknown"
                            local genText = genLabel.Text
                            local mutationText = mutationLabel and mutationLabel.Text or ""
                            local mps = parseMoneyPerSec(genText)
                            local genNumber = tonumber(genText:match("%d+")) or 0
                            local value = mps > 0 and mps or genNumber

                            if value > bestValue then
                                bestValue = value
                                bestPet = {name = petName, info = genText, mutation = mutationText, part = spawnPart, value = value}
                            end
                        end
                    end
                end
            end
        end
    end

    return bestPet
end

-- Update ESP liên tục
local function updateESP()
    local pet = findBestPet()
    if pet then
        local needUpdate = false
        if not currentESP then
            needUpdate = true
        elseif currentPetInfo then
            if pet.value > currentPetInfo.value or pet.mutation ~= currentPetInfo.mutation then
                needUpdate = true
            end
        end

        if needUpdate then
            currentPetInfo = pet
            createESP(pet.name, pet.info, pet.mutation, pet.part)
            createBeam(pet.part)
        end
    else
        if currentESP then
            currentESP:Destroy()
            currentESP = nil
            currentPetInfo = nil
        end
        if currentBeam then
            currentBeam:Destroy()
            currentBeam = nil
        end
    end
end

-- Loop update 0.3s
task.spawn(function()
    while task.wait(0.3) do
        updateESP()
    end
end)








local Players = game:GetService("Players")
local PathfindingService = game:GetService("PathfindingService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

-- Fungsi cari DeliveryHitbox
local function FindDelivery()
    local plots = workspace:WaitForChild("Plots", 5) -- Added timeout
    if not plots then
        warn("Plots folder not found in workspace")
        return nil
    end
    
    for _, plot in pairs(plots:GetChildren()) do
        local sign = plot:FindFirstChild("PlotSign")
        if sign then
            local yourBase = sign:FindFirstChild("YourBase")
            if yourBase and yourBase.Enabled then
                local hitbox = plot:FindFirstChild("DeliveryHitbox")
                if hitbox then 
                    return hitbox 
                end
            end
        end
    end
    warn("No valid DeliveryHitbox found")
    return nil
end

-- Fungsi jalan ke target (pakai Pathfinding)
local function WalkTo(target)
    if not target or not target:IsA("BasePart") then 
        warn("Invalid target for WalkTo")
        return 
    end

    -- Buat path
    local path = PathfindingService:CreatePath({
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true,
        AgentJumpHeight = 8,
        AgentMaxSlope = 45
    })

    local success, errorMessage = pcall(function()
        path:ComputeAsync(hrp.Position, target.Position)
    end)

    if not success then
        warn("Path computation failed: " .. tostring(errorMessage))
        return
    end

    if path.Status == Enum.PathStatus.Success then
        local waypoints = path:GetWaypoints()
        for _, waypoint in ipairs(waypoints) do
            if not humanoid or not hrp or not humanoid.Parent then
                warn("Character components missing during pathfinding")
                return
            end
            
            humanoid:MoveTo(waypoint.Position)
            local moveSuccess, moveError = pcall(function()
                humanoid.MoveToFinished:Wait(2) -- Added timeout
            end)
            
            if not moveSuccess then
                warn("MoveTo failed: " .. tostring(moveError))
                return
            end
        end
    else
        warn("Path not found! Status: " .. tostring(path.Status))
    end
end

-- Handle character respawn
local function onCharacterAdded(newCharacter)
    character = newCharacter
    humanoid = character:WaitForChild("Humanoid")
    hrp = character:WaitForChild("HumanoidRootPart")
end

-- Connect character added event
player.CharacterAdded:Connect(onCharacterAdded)

-- Main execution
local function main()
    local delivery = FindDelivery()
    if delivery then
        WalkTo(delivery) -- Pass the part, not the position
    else
        warn("Failed to start pathfinding: No delivery hitbox found")
    end
end

-- Run main function with error handling
local success, errorMessage = pcall(main)
if not success then
    warn("Main execution failed: " .. tostring(errorMessage))
end
